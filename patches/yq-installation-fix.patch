From fad5e42c2bf76f4d8aa437047c0a0eb0bf3a14ff Mon Sep 17 00:00:00 2001
From: GitHub Copilot <copilot@github.com>
Date: Tue, 17 Feb 2026 00:06:25 +0000
Subject: [PATCH] fix: install yq in Docker container for YAML parsing

The build_app.sh script sources config_loader.sh which uses yq
for parsing app_config.yml. Without yq installed in the ESP-IDF
Docker container, the build fails.

This change installs yq (v4.44.6) before running the build script,
ensuring that YAML configuration parsing works correctly.

Fixes: hardfoc/hf-core#4
---
 .github/workflows/ru-build.yml | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/.github/workflows/ru-build.yml b/.github/workflows/ru-build.yml
index eac9c9e..317b51a 100644
--- a/.github/workflows/ru-build.yml
+++ b/.github/workflows/ru-build.yml
@@ -173,6 +173,19 @@ jobs:
             done
             echo "======================================================"
             echo ""
+            # Install yq for YAML parsing in config_loader.sh
+            echo "======================================================"
+            echo "INSTALLING YQ"
+            echo "======================================================"
+            YQ_VERSION="4.44.6"
+            YQ_ARCH="linux_amd64"
+            echo "Installing yq version ${YQ_VERSION} for ${YQ_ARCH}..."
+            wget -q "https://github.com/mikefarah/yq/releases/download/v${YQ_VERSION}/yq_${YQ_ARCH}" -O /usr/local/bin/yq
+            chmod +x /usr/local/bin/yq
+            echo "yq installed successfully:"
+            yq --version
+            echo "======================================================"
+            echo ""
             # Project tools directory already validated in generate-matrix job
             # Run build script with correct paths
             "${{ needs.generate-matrix.outputs.project_tools_path }}/build_app.sh" \
-- 
2.52.0

