<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HF-Core Platform: Tmc9660Handler.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HF-Core Platform<span id="projectnumber">&#160;0.1.0-dev</span>
   </div>
   <div id="projectbrief">Hardware-Agnostic Handler Layer &amp; RTOS Utilities for HardFOC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('Tmc9660Handler_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle"><div class="title">Tmc9660Handler.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Unified handler for TMC9660 motor controller with GPIO, ADC, and temperature integration.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;cstdint&gt;</code><br />
<code>#include &lt;memory&gt;</code><br />
<code>#include &lt;array&gt;</code><br />
<code>#include &lt;atomic&gt;</code><br />
<code>#include &lt;type_traits&gt;</code><br />
<code>#include &quot;core/hf-core-drivers/external/hf-tmc9660-driver/inc/tmc9660.hpp&quot;</code><br />
<code>#include &quot;core/hf-core-drivers/external/hf-tmc9660-driver/inc/tmc9660_comm_interface.hpp&quot;</code><br />
<code>#include &quot;base/BaseGpio.h&quot;</code><br />
<code>#include &quot;base/BaseAdc.h&quot;</code><br />
<code>#include &quot;base/BaseTemperature.h&quot;</code><br />
<code>#include &quot;base/BaseSpi.h&quot;</code><br />
<code>#include &quot;base/BaseUart.h&quot;</code><br />
<code>#include &quot;core/hf-core-drivers/internal/hf-internal-interface-wrap/inc/utils/RtosMutex.h&quot;</code><br />
<code>#include &lt;utility&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Tmc9660Handler.h:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Tmc9660Handler_8h__incl.svg" width="1986" height="154"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="Tmc9660Handler_8h__dep__incl.svg" width="848" height="124"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="Tmc9660Handler_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTmc9660CtrlPins.html">Tmc9660CtrlPins</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shared helper holding the four TMC9660 host-side control pin references.  <a href="structTmc9660CtrlPins.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHalSpiTmc9660Comm.html">HalSpiTmc9660Comm</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concrete SPI communication adapter for TMC9660 using BaseSpi and BaseGpio.  <a href="classHalSpiTmc9660Comm.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHalUartTmc9660Comm.html">HalUartTmc9660Comm</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concrete UART communication adapter for TMC9660 using BaseUart and BaseGpio.  <a href="classHalUartTmc9660Comm.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTmc9660Handler.html">Tmc9660Handler</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unified, non-templated handler for a single TMC9660 motor controller device.  <a href="classTmc9660Handler.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTmc9660Handler_1_1Gpio.html">Tmc9660Handler::Gpio</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">BaseGpio adapter for a single TMC9660 internal GPIO channel.  <a href="classTmc9660Handler_1_1Gpio.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTmc9660Handler_1_1Adc.html">Tmc9660Handler::Adc</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">BaseAdc adapter for all TMC9660 ADC channels.  <a href="classTmc9660Handler_1_1Adc.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTmc9660Handler_1_1Temperature.html">Tmc9660Handler::Temperature</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">BaseTemperature adapter for the TMC9660 internal chip temperature sensor.  <a href="classTmc9660Handler_1_1Temperature.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Unified handler for TMC9660 motor controller with GPIO, ADC, and temperature integration. </p>
<p>This file provides the complete HAL-level integration for a single TMC9660 motor driver device. It bridges the HardFOC base interfaces (BaseSpi, BaseUart, BaseGpio, BaseAdc, BaseTemperature) with the templated tmc9660::TMC9660&lt;CommType&gt; driver from the hf-tmc9660-driver library.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Architecture Overview</h2>
<p>The file contains three layers:</p>
<ol type="1">
<li><b>CRTP Communication Adapters</b> (<a class="el" href="classHalSpiTmc9660Comm.html" title="Concrete SPI communication adapter for TMC9660 using BaseSpi and BaseGpio.">HalSpiTmc9660Comm</a>, <a class="el" href="classHalUartTmc9660Comm.html" title="Concrete UART communication adapter for TMC9660 using BaseUart and BaseGpio.">HalUartTmc9660Comm</a>): Bridge HardFOC BaseSpi/BaseUart/BaseGpio to the TMC9660 driver's CRTP-based communication interfaces (tmc9660::SpiCommInterface, tmc9660::UartCommInterface). These also manage the four host-side GPIO control pins (RST, DRV_EN, FAULTN, WAKE) required by the TMC9660 bootloader initialization sequence.</li>
<li><b><a class="el" href="classTmc9660Handler.html" title="Unified, non-templated handler for a single TMC9660 motor controller device.">Tmc9660Handler</a></b> (main class): Non-templated facade that owns one typed driver instance (SpiDriver or UartDriver). Uses the visitDriver() template to route calls to the active driver, keeping the public API free of template parameters. Provides:<ul>
<li>Bootloader initialization with configurable reset and verification options</li>
<li>TMCL parameter read/write and raw command access</li>
<li>Convenience methods for motor control (velocity, position, torque)</li>
<li>Telemetry (voltage, temperature, current, flags)</li>
<li>visitDriver() for advanced users needing direct subsystem access</li>
</ul>
</li>
<li><b>Peripheral Wrappers</b> (Gpio, Adc, Temperature inner classes): Implement BaseGpio, BaseAdc, and BaseTemperature respectively, delegating to the TMC9660 driver's subsystems (gpio, telemetry, etc.) via the handler's visitDriver().</li>
</ol>
<h2><a class="anchor" id="autotoc_md22"></a>
Ownership Model</h2>
<p>The handler owns all its internal resources:</p><ul>
<li>One <a class="el" href="classHalSpiTmc9660Comm.html" title="Concrete SPI communication adapter for TMC9660 using BaseSpi and BaseGpio.">HalSpiTmc9660Comm</a> or <a class="el" href="classHalUartTmc9660Comm.html" title="Concrete UART communication adapter for TMC9660 using BaseUart and BaseGpio.">HalUartTmc9660Comm</a> (communication adapter)</li>
<li>One SpiDriver or UartDriver (typed TMC9660 driver)</li>
<li>Two Gpio wrappers (for GPIO17, GPIO18)</li>
<li>One Adc wrapper (multi-channel TMC9660 ADC)</li>
<li>One Temperature wrapper (chip temperature sensor)</li>
</ul>
<p>External managers (AdcManager, TemperatureManager) that need to own a BaseAdc* or BaseTemperature* should use the thin delegation wrappers <a class="el" href="classTmc9660AdcWrapper.html" title="Delegation wrapper that adapts Tmc9660Handler::Adc for external ownership.">Tmc9660AdcWrapper</a> and Tmc9660TemperatureWrapper (defined in their own files), which delegate to the handler's inner class instances.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Initialization Sequence</h2>
<div class="fragment"><div class="line"><span class="comment">// 1. Obtain SPI/UART interface and four GPIO control pin instances</span></div>
<div class="line"><span class="comment">// 2. Construct the handler</span></div>
<div class="line"><a class="code hl_class" href="classTmc9660Handler.html">Tmc9660Handler</a> handler(spi, rst_gpio, drv_en_gpio, faultn_gpio, wake_gpio, 0x01);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 3. Initialize (runs bootloader config, enters parameter mode)</span></div>
<div class="line"><span class="keywordflow">if</span> (!handler.Initialize()) { <span class="keywordflow">return</span>; }</div>
<div class="line"> </div>
<div class="line"><span class="comment">// 4. Use motor control, telemetry, GPIO, ADC, etc.</span></div>
<div class="line">handler.SetTargetVelocity(1000);</div>
<div class="line"><span class="keywordtype">float</span> voltage = handler.GetSupplyVoltage();</div>
<div class="ttc" id="aclassTmc9660Handler_html"><div class="ttname"><a href="classTmc9660Handler.html">Tmc9660Handler</a></div><div class="ttdoc">Unified, non-templated handler for a single TMC9660 motor controller device.</div><div class="ttdef"><b>Definition</b> Tmc9660Handler.h:442</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Thread Safety</h2>
<p>Individual handler methods are NOT thread-safe by themselves. If multiple threads access the same handler, external synchronization is required. The Adc and Temperature inner classes use RtosMutex for their internal statistics tracking.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classTmc9660AdcWrapper.html" title="Delegation wrapper that adapts Tmc9660Handler::Adc for external ownership.">Tmc9660AdcWrapper</a> Thin adapter for AdcManager ownership </dd>
<dd>
Tmc9660TemperatureWrapper Thin adapter for TemperatureManager ownership </dd>
<dd>
MotorController Higher-level manager that owns <a class="el" href="classTmc9660Handler.html" title="Unified, non-templated handler for a single TMC9660 motor controller device.">Tmc9660Handler</a> instances</dd></dl>
<dl class="section author"><dt>Author</dt><dd>HardFOC Team </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025 </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_97bbe734eff8d6674660850430e62f3c.html">handlers</a></li><li class="navelem"><a class="el" href="dir_57a9b4ae0972c7aba1e3c2e0355f42ff.html">tmc9660</a></li><li class="navelem"><a class="el" href="Tmc9660Handler_8h.html">Tmc9660Handler.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
